!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VuetifyImageInput=t()}(this,(function(){"use strict";async function e(e){let t=new Image;return t.src=e,await t.decode(),t}async function t(t,l){if(function(e){return"string"==typeof e}(t))return e(t);if(function(e){let{File:t}=globalThis;return t&&e instanceof t}(t))return async function(t,l){let a=new FileReader,n=new Promise(((e,t)=>{a.addEventListener("load",e),a.addEventListener("abort",t),a.addEventListener("error",t)}));return a.readAsDataURL(t),l.onabort=()=>{a.abort()},await n,l.onabort=null,e(a.result)}(t,l);throw new Error}let{computed:l,defineComponent:a,h:n,shallowRef:u,watch:i,watchEffect:r,triggerRef:o}=Vue;return a({name:"VImageInput",props:{cancelIcon:{type:String,default:"$cancel"},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:"$clear"},disabled:{type:Boolean,default:!1},errorIcon:{type:String,default:"$error"},flipHorizontallyIcon:{type:String,default:"mdi-flip-horizontal"},flippable:{type:Boolean,default:!1},flipVerticallyIcon:{type:String,default:"mdi-flip-vertical"},fullHeight:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1},imageBackgroundColor:String,imageHeight:{type:Number,default:256},imageMaxHeight:{type:Number,default:512},imageMaxWidth:{type:Number,default:512},imageMinHeight:{type:Number,default:128},imageMinWidth:{type:Number,default:128},imageWidth:{type:Number,default:256},maxZoom:{type:Number,default:1},minZoom:{type:String,default:"cover"},resetable:{type:Boolean,default:!1},resetIcon:{type:String,default:"mdi-restore"},resizable:{type:Boolean,default:!1},rotatable:{type:Boolean,default:!1},rotateClockwiseIcon:{type:String,default:"mdi-rotate-right"},rotateCounterClockwiseIcon:{type:String,default:"mdi-rotate-left"},successIcon:{type:String,default:"$success"},translatable:{type:Boolean,default:!1},uploadIcon:{type:String,default:"mdi-upload"},value:String,zoomable:{type:Boolean,default:!1},zoomInIcon:{type:String,default:"mdi-magnify-plus-outline"},zoomOutIcon:{type:String,default:"mdi-magnify-minus-outline"}},setup(e,{emit:a}){let r=u(null),o=l((()=>{let e=r.value;return e?e.naturalWidth:0})),d=l((()=>{let e=r.value;return e?e.naturalHeight:0})),c=l((()=>{let e=r.value;return e?e.src:null})),f=u(256),v=u(256),s=u(null),m=u(!1),p=()=>{m.value=!m.value},g=u(!1),y=()=>{g.value=!g.value},h=u(0),b=e=>{m.value!==g.value&&(e*=-1),h.value+=e},I=Math.PI/2,w=()=>{b(+I)},S=()=>{b(-I)},k=l((()=>.1)),C=l((()=>{let t=k.value,l=e.maxZoom;return Math.max(t,l)})),x=u(0),B=l({get(){let e=k.value,t=C.value;return function(e,t,l){return Math.min(Math.max(e,t),l)}(x.value,e,t)},set(e){x.value=e}}),z=e=>{B.value+=e},E=l((()=>{let e=k.value;return(C.value-e)/10})),$=()=>{let e=E.value;z(+e)},M=()=>{let e=E.value;z(-e)};l((()=>{let e=k.value;return(C.value-e)/1e3}));let N={},H={},L={},V=u(null),W=l((()=>V.value===N)),R=l((()=>V.value===H)),D=l((()=>V.value===L)),j=null,A=async e=>{j&&(j.abort(),j=null),j=new AbortController;let{signal:l}=j;try{V.value=N;let a=await t(e,l);l.aborted||(V.value=H,r.value=a)}catch{l.aborted||(V.value=L)}};i((()=>e.modelValue),(e=>{null==e?r.value=null:A(e)}),{immediate:!0}),i(s,(e=>{a("update:modelValue",e)})),i((()=>{let t=r.value;if(t){let l=o.value,a=d.value,{imageFormat:n,imageQuality:u}=e,i=f.value,r=v.value,c=m.value,s=g.value,p=h.value,y=B.value,b=document.createElement("canvas"),I=b.getContext("2d");return b.width=i,b.height=r,I.translate(i/2,r/2),I.scale(y,y),I.scale(c?-1:1,s?-1:1),I.rotate(p),I.drawImage(t,-l/2,-a/2),b.toDataURL(`image/${n}`,u)}return null}),(e=>{s.value=e}));let F=e=>{e.preventDefault();let t=document.createElement("input");t.setAttribute("type","file"),t.addEventListener("change",(e=>{e.preventDefault();let{files:t}=e.target;if(t&&t.length){let[e]=t;A(e)}})),t.click()};return()=>{let e=o.value,t=d.value,l=c.value,a=W.value,u=R.value,i=D.value,r=f.value,b=v.value,I=s.value,k=m.value,C=g.value,x=h.value,z=B.value;return n("div",[n("div",{style:{whiteSpace:"pre-wrap"}},JSON.stringify({internalImageWidth:e,internalImageHeight:t,loading:a,loadSuccess:u,loadError:i},null,"\t")),n("div",{onClick:F},"click me"),n("div",{onClick:p},"flip horizontally"),n("div",{onClick:y},"flip vertically"),n("div",{onClick:w},"rotate clockwise"),n("div",{onClick:S},"rotate counter clockwise"),n("div",{onClick:$},"zoom in"),n("div",{onClick:M},"zoom out"),...I?[n("img",{src:I,style:{background:"green"}})]:[],...l?[n("div",{style:{height:`${b}px`,pointerEvents:"none",position:"relative",width:`${r}px`}},[n("div",{style:{bottom:"50%",position:"absolute",right:"50%",transform:"translate(50%,50%)"}},[n("img",{src:l,style:{transform:[`scale(${z})`,`scale(${[k?-1:1,C?-1:1].join(",")})`,`rotate(${x}rad)`].join(" "),transition:"all .3s cubic-bezier(.25,.8,.5,1)"}})])])]:[]])}}})}));
