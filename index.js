!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VuetifyImageInput=t()}(this,(function(){"use strict";async function e(e){let t=new Image;return t.src=e,await t.decode(),t}async function t(t,l){if(function(e){return"string"==typeof e}(t))return e(t);if(function(e){let{File:t}=globalThis;return t&&e instanceof t}(t))return async function(t,l){let a=new FileReader,n=new Promise(((e,t)=>{a.addEventListener("load",e),a.addEventListener("abort",t),a.addEventListener("error",t)}));return a.readAsDataURL(t),l.onabort=()=>{a.abort()},await n,l.onabort=null,e(a.result)}(t,l);throw new Error}let{computed:l,defineComponent:a,h:n,shallowRef:u,watch:r,watchEffect:i}=Vue;return a({name:"VImageInput",props:{imageFormat:{type:String,default:"png"},imageQuality:{}},setup(e,{emit:a}){let o=u(null),d=l((()=>{let e=o.value;return e?e.naturalWidth:0})),c=l((()=>{let e=o.value;return e?e.naturalHeight:0}));l((()=>{let e=o.value;return e?e.src:null}));let v=u(256),s=u(256),f=u(null),m=u(!1),g=()=>{m.value=!m.value},p=u(!1),h=()=>{p.value=!p.value},y={},w={},b={},E=u(null),I=l((()=>E.value===y)),k=l((()=>E.value===w)),C=l((()=>E.value===b)),L=null,V=async e=>{L&&(L.abort(),L=null),L=new AbortController;let{signal:l}=L;try{E.value=y;let a=await t(e,l);l.aborted||(E.value=w,o.value=a)}catch{l.aborted||(E.value=b)}};r((()=>e.modelValue),(e=>{null==e?o.value=null:V(e)}),{immediate:!0}),r(f,(e=>{a("update:modelValue",e)})),i((()=>{let t=o.value;if(t){d.value,c.value;let l=v.value,a=s.value,n=m.value,u=p.value,{imageFormat:r,imageQuality:i}=e,o=document.createElement("canvas"),g=o.getContext("2d");o.width=l,o.height=a;let h=l,y=a,w=0,b=0;g.translate(w+h/2,b+y/2),g.scale(n?-1:1,u?-1:1),g.drawImage(t,-h/2,-y/2);let E=o.toDataURL(`image/${r}`,i);f.value=E}else f.value=null}));let D=e=>{e.preventDefault();let t=document.createElement("input");t.setAttribute("type","file"),t.addEventListener("change",(e=>{e.preventDefault();let{files:t}=e.target;if(t&&t.length){let[e]=t;V(e)}})),t.click()};return()=>{let e=d.value,t=c.value,l=I.value,a=k.value,u=C.value,r=f.value;return n("div",[n("div",{style:{whiteSpace:"pre-wrap"}},JSON.stringify({internalImageWidth:e,internalImageHeight:t,loading:l,loadSuccess:a,loadError:u},null,"\t")),n("div",{onClick:D},"click me"),n("div",{onClick:g},"flip horizontally"),n("div",{onClick:h},"flip vertically"),...r?[n("img",{src:r,style:{background:"green"}})]:[]])}}})}));
