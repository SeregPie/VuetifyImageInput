!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VuetifyImageInput=t()}(this,(function(){"use strict";async function e(e){let t=new Image;return t.src=e,await t.decode(),t}async function t(t,l){if(function(e){return"string"==typeof e}(t))return e(t);if(function(e){let{File:t}=globalThis;return t&&e instanceof t}(t))return async function(t,l){let a=new FileReader,n=new Promise(((e,t)=>{a.addEventListener("load",e),a.addEventListener("abort",t),a.addEventListener("error",t)}));return a.readAsDataURL(t),l.onabort=()=>{a.abort()},await n,l.onabort=null,e(a.result)}(t,l);throw new Error}let{computed:l,defineComponent:a,h:n,shallowRef:o,watch:r,watchEffect:u,triggerRef:i,resolveComponent:d}=Vue;return a({name:"VImageInput",props:{cancelIcon:{type:String,default:"$cancel"},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:"$clear"},disabled:{type:Boolean,default:!1},errorIcon:{type:String,default:"$error"},flipHorizontallyIcon:{type:String,default:"mdi-flip-horizontal"},flippable:{type:Boolean,default:!1},flipVerticallyIcon:{type:String,default:"mdi-flip-vertical"},fullHeight:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1},imageBackgroundColor:String,imageHeight:{type:Number,default:256},imageMaxHeight:{type:Number,default:512},imageMaxWidth:{type:Number,default:512},imageMinHeight:{type:Number,default:128},imageMinWidth:{type:Number,default:128},imageWidth:{type:Number,default:256},maxZoom:{type:Number,default:1},minZoom:{type:String,default:"cover"},modelValue:String,resetable:{type:Boolean,default:!1},resetIcon:{type:String,default:"mdi-restore"},resizable:{type:Boolean,default:!1},rotatable:{type:Boolean,default:!1},rotateClockwiseIcon:{type:String,default:"mdi-rotate-right"},rotateCounterClockwiseIcon:{type:String,default:"mdi-rotate-left"},successIcon:{type:String,default:"$success"},translatable:{type:Boolean,default:!1},uploadIcon:{type:String,default:"mdi-upload"},zoomable:{type:Boolean,default:!1},zoomInIcon:{type:String,default:"mdi-magnify-plus-outline"},zoomOutIcon:{type:String,default:"mdi-magnify-minus-outline"}},setup(e,{emit:a}){let u=o(null),i=l((()=>{let e=u.value;return e?e.naturalWidth:0})),c=l((()=>{let e=u.value;return e?e.naturalHeight:0})),f=l((()=>{let e=u.value;return e?e.src:null})),s=o(256),m=o(256),p=o(null),v=o(!1),g=()=>{v.value=!v.value},y=o(!1),h=()=>{y.value=!y.value},b=o(0),I=e=>{v.value!==y.value&&(e*=-1),b.value+=e},w=Math.PI/2,C=()=>{I(+w)},S=()=>{I(-w)},x=l((()=>.1)),B=l((()=>{let t=x.value,l=e.maxZoom;return Math.max(t,l)})),z=o(0),$=l({get(){let e=x.value,t=B.value;return function(e,t,l){return Math.min(Math.max(e,t),l)}(z.value,e,t)},set(e){z.value=e}}),E=e=>{$.value+=e},R=l((()=>{let e=x.value;return(B.value-e)/10})),k=()=>{let e=R.value;E(+e)},M=()=>{let e=R.value;E(-e)};l((()=>{let e=x.value;return(B.value-e)/1e3}));let V={},H={},N={},L=o(null);l((()=>L.value===V)),l((()=>L.value===H)),l((()=>L.value===N));let D=null,T=async e=>{D&&(D.abort(),D=null),D=new AbortController;let{signal:l}=D;try{L.value=V;let a=await t(e,l);l.aborted||(L.value=H,u.value=a)}catch{l.aborted||(L.value=N)}};r(p,(e=>{a("update:modelValue",e)})),r((()=>{let t=u.value;if(t){let l=i.value,a=c.value,{imageFormat:n,imageQuality:o}=e,r=s.value,u=m.value,d=v.value,f=y.value,p=b.value,g=$.value,h=document.createElement("canvas"),I=h.getContext("2d");return h.width=r,h.height=u,I.translate(r/2,u/2),I.scale(g,g),I.scale(d?-1:1,f?-1:1),I.rotate(p),I.drawImage(t,-l/2,-a/2),h.toDataURL(`image/${n}`,o)}return null}),(e=>{p.value=e}));let W=e=>{e.preventDefault();let t=document.createElement("input");t.setAttribute("type","file"),t.addEventListener("change",(e=>{e.preventDefault();let{files:t}=e.target;if(t&&t.length){let[e]=t;T(e)}})),t.click()};return()=>{let t=d("VBtn"),l=(e,l)=>n(t,{icon:e,onClick:l}),a=f.value,o=s.value,r=m.value;p.value;let u=v.value,i=y.value,c=b.value,I=$.value;return n("div",{style:{display:"inline-grid",gridTemplateColumns:"1fr auto",gridTemplateRows:"1fr auto"}},[n("div",{style:{gridColumn:1,gridRow:1,overflow:"hidden",position:"relative"}},a?[n("div",{style:{height:`${r}px`,pointerEvents:"none",position:"relative",width:`${o}px`}},[n("div",{style:{bottom:"50%",position:"absolute",right:"50%",transform:"translate(50%,50%)"}},[n("img",{src:a,style:{transform:[`scale(${I})`,`scale(${[u?-1:1,i?-1:1].join(",")})`,`rotate(${c}rad)`].join(" "),transition:"all .3s cubic-bezier(.25,.8,.5,1)"}})])])]:[]),n("div",{style:{display:"flex",flexDirection:"column",gridColumn:2,gridRow:1,justifyContent:"center"}},[n(t,{icon:"mdi-load",onClick:W}),l(e.flipHorizontallyIcon,g),l(e.flipVerticallyIcon,h),l(e.rotateClockwiseIcon,C),l(e.rotateCounterClockwiseIcon,S),l(e.zoomInIcon,k),l(e.zoomOutIcon,M)]),n("div",{style:{gridColumn:1,gridRow:2}})])}}})}));
