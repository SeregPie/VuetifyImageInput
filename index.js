!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VuetifyImageInput=t()}(this,(function(){"use strict";async function e(e){let t=new Image;return t.src=e,await t.decode(),t}async function t(t,l){if(function(e){return"string"==typeof e}(t))return e(t);if(function(e){let{File:t}=globalThis;return t&&e instanceof t}(t))return async function(t,l){let a=new FileReader,n=new Promise(((e,t)=>{a.addEventListener("load",e),a.addEventListener("abort",t),a.addEventListener("error",t)}));return a.readAsDataURL(t),l.onabort=()=>{a.abort()},await n,l.onabort=null,e(a.result)}(t,l);throw new Error}function l(e){return new Promise((t=>{setTimeout(t,e)}))}let{computed:a,createApp:n,h:u,reactive:r,shallowRef:i,watchEffect:o,watch:d,defineComponent:c}=Vue;return c({name:"VImageInput",props:{imageFormat:{type:String,default:"png"},imageQuality:{}},setup(e,{emit:n}){let r=i(null),c=a((()=>{let e=r.value;return e?e.naturalWidth:0})),v=a((()=>{let e=r.value;return e?e.naturalHeight:0}));a((()=>{let e=r.value;return e?e.src:null}));let s=i(256),f=i(256),m=i(null),g=i(false),p=()=>{g.value=!g.value},h=i(false),y=()=>{h.value=!h.value},w=e=>{g.value=!1,h.value=!1,r.value=e},b=()=>w(null),E={},I={},k={},C=i(null),L=a((()=>C.value===E)),V=a((()=>C.value===I)),A=a((()=>C.value===k)),D=null,F=async e=>{D&&(D.abort(),D=null),D=new AbortController;let{signal:a}=D;try{C.value=E;let n=await t(e,a);a.aborted||(C.value=I,await l(1e3),a.aborted||(r.value=n))}catch{a.aborted||(C.value=k,await l(1e3),a.aborted||b())}};d((()=>e.modelValue),(e=>{null==e?b():F(e)}),{immediate:!0}),d(m,(e=>{n("update:modelValue",e)})),o((()=>{let t=r.value;if(t){c.value,v.value;let l=s.value,a=f.value,n=g.value,u=h.value,{imageFormat:r,imageQuality:i}=e,o=document.createElement("canvas"),d=o.getContext("2d");o.width=l,o.height=a;let p=l,y=a,w=0,b=0;d.translate(w+p/2,b+y/2),d.scale(n?-1:1,u?-1:1),d.drawImage(t,-p/2,-y/2);let E=o.toDataURL(`image/${r}`,i);m.value=E}else m.value=null}));let R=e=>{e.preventDefault();let t=document.createElement("input");t.setAttribute("type","file"),t.addEventListener("change",(e=>{e.preventDefault();let{files:t}=e.target;if(t&&t.length){let[e]=t;F(e)}})),t.click()};return()=>{let e=c.value,t=v.value,l=L.value,a=V.value,n=A.value,r=m.value;return u("div",[u("div",{style:{whiteSpace:"pre-wrap"}},JSON.stringify({internalImageWidth:e,internalImageHeight:t,loading:l,loadSuccess:a,loadError:n},null,"\t")),u("div",{onClick:R},"click me"),u("div",{onClick:p},"flip horizontally"),u("div",{onClick:y},"flip vertically"),...r?[u("img",{src:r,style:{background:"green"}})]:[]])}}})}));
