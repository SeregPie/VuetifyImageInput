!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VuetifyImageInput=t()}(this,(function(){"use strict";var e={pointerEvents:"none",userDrag:"none",userSelect:"none"},t={...e,opacity:0,visibility:"hidden"},l={transition:"all .3s cubic-bezier(.25,.8,.5,1)"},a={bottom:"50%",position:"absolute",right:"50%",transform:"translate(50%,50%)"},n={position:"relative"},i={bottom:0,left:0,position:"absolute",right:0,top:0},r={overflow:"hidden"};function u(e,t,l){return function(e,t,l){return{background:`url('data:image/svg+xml;base64,${btoa(e)}') center center / ${t}px ${t}px repeat ${l}`}}(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2 2" fill="${t}"><rect x="1" width="1" height="1"/><rect y="1" width="1" height="1"/></svg>`,2*e,l)}async function o(e){let t=new Image;return t.src=e,await t.decode(),t}async function d(e,t){if(function(e){return"string"==typeof e}(e))return o(e);if(function(e){let{File:t}=globalThis;return t&&e instanceof t}(e))return async function(e,t){let l=new FileReader,a=new Promise(((e,t)=>{l.addEventListener("load",e),l.addEventListener("abort",t),l.addEventListener("error",t)}));return l.readAsDataURL(e),t.onabort=()=>{l.abort()},await a,t.onabort=null,o(l.result)}(e,t);throw new Error}function c(e,t,l){return Math.min(Math.max(e,t),l)}let{computed:s,defineComponent:f,h:v,shallowRef:m,watch:p,watchEffect:g,triggerRef:y,resolveComponent:h,customRef:b}=Vue;return f({name:"VImageInput",props:{cancelIcon:{type:String,default:"$cancel"},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:"$clear"},disabled:{type:Boolean,default:!1},errorIcon:{type:String,default:"$error"},flipHorizontallyIcon:{type:String,default:"mdi-flip-horizontal"},flipVerticallyIcon:{type:String,default:"mdi-flip-vertical"},fullHeight:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1},imageBackgroundColor:String,imageHeight:{type:Number,default:256},imageMaxHeight:{type:Number,default:512},imageMaxWidth:{type:Number,default:512},imageMinHeight:{type:Number,default:128},imageMinWidth:{type:Number,default:128},imageWidth:{type:Number,default:256},maxZoom:{type:Number,default:1},minZoom:{type:String,default:"cover"},modelValue:String,readonly:{type:Boolean,default:!1},resetable:{type:Boolean,default:!1},resetIcon:{type:String,default:"mdi-restore"},rotateClockwiseIcon:{type:String,default:"mdi-rotate-right"},rotateCounterClockwiseIcon:{type:String,default:"mdi-rotate-left"},successIcon:{type:String,default:"$success"},uploadIcon:{type:String,default:"mdi-upload"},zoomInIcon:{type:String,default:"mdi-magnify-plus-outline"},zoomOutIcon:{type:String,default:"mdi-magnify-minus-outline"}},setup(o,{emit:f}){let g=m(null),y=s((()=>{let e=g.value;return e?e.naturalWidth:0})),w=s((()=>{let e=g.value;return e?e.naturalHeight:0})),I=s((()=>{let e=g.value;return e?e.src:null})),x=m(256),C=m(256),$=m(null),S=m(!1),k=()=>{S.value=!S.value},R=m(!1),E=()=>{R.value=!R.value},M=m(0),z=e=>{S.value!==R.value&&(e*=-1),M.value+=e},B=Math.PI/2,H=()=>{z(+B)},V=()=>{z(-B)},N=s((()=>.1)),D=s((()=>{let e=N.value,t=o.maxZoom;return Math.max(e,t)})),L=b(((e,t)=>{let l=0;return{get(){e();let t=N.value,a=D.value;return c(l,t,a)},set(e){l=e,t()}}})),T=e=>{L.value+=e},W=s((()=>{let e=N.value;return(D.value-e)/10})),j=()=>{let e=W.value;T(+e)},F=()=>{let e=W.value;T(-e)};s((()=>{let e=N.value;return(D.value-e)/1e3}));let A=b(((e,t)=>{let l=0;return{get(){e();return c(l,-(1/0),Infinity)},set(e){l=e,t()}}})),O=b(((e,t)=>{let l=0;return{get(){e();return c(l,-(1/0),Infinity)},set(e){l=e,t()}}})),P=(e,t)=>{let l=S.value,a=R.value,n=M.value,i=L.value;l&&(e*=-1),a&&(t*=-1),e/=i,t/=i;let r=Math.sin(n),u=Math.cos(n);A.value+=e*u+t*r,O.value-=e*r-t*u},U=()=>{g.value=null},Z={},G={},Q={},q=m(null);s((()=>q.value===Z)),s((()=>q.value===G)),s((()=>q.value===Q));let J=null,K=async e=>{J&&(J.abort(),J=null),J=new AbortController;let{signal:t}=J;try{q.value=Z;let l=await d(e,t);t.aborted||(q.value=G,g.value=l)}catch{t.aborted||(q.value=Q)}};p((()=>o.modelValue),(e=>{if(e){$.value!==e&&K(e)}else U()}),{immediate:!0}),p($,(e=>{f("update:modelValue",e)})),p((()=>{let e=g.value;if(e){let t=y.value,l=w.value,{imageFormat:a,imageQuality:n}=o,i=x.value,r=C.value,u=S.value,d=R.value,c=A.value,s=O.value,f=M.value,v=L.value,m=document.createElement("canvas"),p=m.getContext("2d");return m.width=i,m.height=r,p.translate(i/2,r/2),p.scale(v,v),p.scale(u?-1:1,d?-1:1),p.rotate(f),p.translate(c,s),p.drawImage(e,-t/2,-l/2),m.toDataURL(`image/${a}`,n)}return null}),(e=>{$.value=e}));let X=e=>{e.preventDefault();let t=document.createElement("input");t.setAttribute("type","file"),t.addEventListener("change",(e=>{e.preventDefault();let{files:t}=e.target;if(t&&t.length){let[e]=t;K(e)}})),t.click()};return()=>{let d=h("VBtn"),c=(e,t)=>{let{disabled:l}=o;return v(d,{disabled:l,icon:e,onClick:t})},{clearable:s,disabled:f,readonly:m}=o,p=g.value,y=I.value,b=x.value,w=C.value;$.value;let z=S.value,B=R.value,N=A.value,D=O.value,T=M.value,W=L.value;return v("div",{style:{display:"inline-grid",gridTemplateColumns:"1fr auto",gridTemplateRows:"1fr auto"}},[v("div",{style:{...u(8,"#fff","#000"),...r,...n,gridColumn:1,gridRow:1,minHeight:`${w+50}px`,minWidth:`${b+50}px`}},y?[v("div",{style:{...e,...a,width:`${b}px`,height:`${w}px`}},[v("div",{style:{...a}},[v("img",{src:y,style:{display:"block",transform:[`scale(${W})`,`scale(${[z?-1:1,B?-1:1].join(",")})`,`rotate(${T}rad)`,`translate(${N}px,${D}px)`].join(" "),transition:"all .3s cubic-bezier(.25,.8,.5,1)"}})]),v("div",{style:{...i,boxShadow:"0 0 4000px 4000px rgba(0,0,0,0.5)",outline:"4px solid #fff"}})])]:[v(d,{icon:"mdi-upload",onClick:X})]),v("div",{style:{display:"flex",flexDirection:"column",gridColumn:2,gridRow:1,justifyContent:"center",...l,...p?{}:t}},[...m?[]:[...s?[c(o.clearIcon,U)]:[],c(o.flipHorizontallyIcon,k),c(o.flipVerticallyIcon,E),c(o.rotateClockwiseIcon,H),c(o.rotateCounterClockwiseIcon,V)],v("div",{onClick(){P(0,-10)}},"UP"),v("div",{onClick(){P(0,10)}},"DOWN"),v("div",{onClick(){P(-10,0)}},"LEFT"),v("div",{onClick(){P(10,0)}},"RIGHT")]),v("div",{style:{gridColumn:1,gridRow:2,...l,...p?{}:t}},m?[]:[v("div",{style:{display:"flex",justifyContent:"space-between"}},[c(o.zoomOutIcon,F),c(o.zoomInIcon,j)])])])}}})}));
