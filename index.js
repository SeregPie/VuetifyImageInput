!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("vue")):"function"==typeof define&&define.amd?define(["vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).VuetifyImageInput=t(e.Vue)}(this,(function(e){"use strict";var t={pointerEvents:"none",userDrag:"none",userSelect:"none"},l={...t,opacity:0,visibility:"hidden"},a={transition:"all .3s cubic-bezier(.25,.8,.5,1)"},n={bottom:"50%",position:"absolute",right:"50%",transform:"translate(50%,50%)"},i={position:"relative"},u={bottom:0,left:0,position:"absolute",right:0,top:0},o={overflow:"hidden"};function r(e,t,l){return function(e,t,l){return{background:`url('data:image/svg+xml;base64,${btoa(e)}') center center / ${t}px ${t}px repeat ${l}`}}(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2 2" fill="${t}"><rect x="1" width="1" height="1"/><rect y="1" width="1" height="1"/></svg>`,2*e,l)}async function d(e){let t=new Image;return t.src=e,await t.decode(),t}async function c(e,t){if(function(e){return"string"==typeof e}(e))return d(e);if(function(e){let{File:t}=globalThis;return t&&e instanceof t}(e))return async function(e,t){let l=new FileReader,a=new Promise(((e,t)=>{l.addEventListener("load",e),l.addEventListener("abort",t),l.addEventListener("error",t)}));return l.readAsDataURL(e),t.onabort=()=>{l.abort()},await a,t.onabort=null,d(l.result)}(e,t);throw new Error}function s(e,t,l){return Math.min(Math.max(e,t),l)}return e.defineComponent({name:"VImageInput",props:{cancelIcon:{type:String,default:"$cancel"},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:"$clear"},disabled:{type:Boolean,default:!1},errorIcon:{type:String,default:"$error"},flipHorizontallyIcon:{type:String,default:"mdi-flip-horizontal"},flipVerticallyIcon:{type:String,default:"mdi-flip-vertical"},fullHeight:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1},imageBackgroundColor:String,imageHeight:{type:Number,default:256},imageMaxHeight:{type:Number,default:512},imageMaxWidth:{type:Number,default:512},imageMinHeight:{type:Number,default:128},imageMinWidth:{type:Number,default:128},imageWidth:{type:Number,default:256},imageMaxScaling:{type:Number,default:1},imageMinScaling:{type:String,default:"cover"},modelValue:String,readonly:{type:Boolean,default:!1},resetable:{type:Boolean,default:!1},resetIcon:{type:String,default:"mdi-restore"},rotateClockwiseIcon:{type:String,default:"mdi-rotate-right"},rotateCounterClockwiseIcon:{type:String,default:"mdi-rotate-left"},successIcon:{type:String,default:"$success"},uploadIcon:{type:String,default:"mdi-upload"},zoomInIcon:{type:String,default:"mdi-magnify-plus-outline"},zoomOutIcon:{type:String,default:"mdi-magnify-minus-outline"}},setup(d,{emit:v}){let m=e.shallowRef(null),f=e.computed((()=>{let e=m.value;return e?e.naturalWidth:0})),p=e.computed((()=>{let e=m.value;return e?e.naturalHeight:0})),g=e.computed((()=>{let e=m.value;return e?e.src:null})),h=e.shallowRef(256),y=e.shallowRef(256),b=e.shallowRef(null),w=e.shallowRef(!1),x=()=>{w.value=!w.value},I=e.shallowRef(!1),M=()=>{I.value=!I.value},C=e.shallowRef(0),S=e=>{w.value!==I.value&&(e*=-1),C.value+=e},R=Math.PI/3,$=()=>{S(+R)},k=()=>{S(-R)},H=e.computed((()=>{let e=f.value,t=p.value,l=C.value;return e*Math.abs(Math.cos(l))+t*Math.abs(Math.sin(l))})),z=e.computed((()=>{let e=f.value,t=p.value,l=C.value;return e*Math.abs(Math.sin(l))+t*Math.abs(Math.cos(l))})),V=e.computed((()=>{switch(d.imageMinScaling){case"cover":return Math.max(d.imageWidth/H.value,d.imageHeight/z.value);case"contain":return Math.min(d.imageWidth/H.value,d.imageHeight/z.value)}return 0})),B=e.computed((()=>{let e=V.value,t=d.imageMaxScaling;return Math.max(e,t)})),E=e.customRef(((e,t)=>{let l=0;return{get(){e();let t=V.value,a=B.value;return s(l,t,a)},set(e){l=e,t()}}})),N=e=>{E.value+=e},W=e.computed((()=>{let e=V.value;return(B.value-e)/10})),D=()=>{let e=W.value;N(+e)},L=()=>{let e=W.value;N(-e)};e.computed((()=>{let e=V.value;return(B.value-e)/1e3}));let T=e.computed((()=>-1/0)),j=e.computed((()=>1/0)),F=e.customRef(((e,t)=>{let l=0;return{get(){e();let t=T.value,a=j.value;return s(l,t,a)},set(e){l=e,t()}}})),O=e.computed((()=>-1/0)),A=e.computed((()=>1/0)),P=e.customRef(((e,t)=>{let l=0;return{get(){e();let t=O.value,a=A.value;return s(l,t,a)},set(e){l=e,t()}}})),U=(e,t)=>{let l=w.value,a=I.value,n=C.value,i=E.value;l&&(e*=-1),a&&(t*=-1),e/=i,t/=i;let u=Math.sin(n),o=Math.cos(n);F.value+=e*o+t*u,P.value-=e*u-t*o},q=()=>{m.value=null},G={},J={},Q={},K=e.shallowRef(null);e.computed((()=>K.value===G)),e.computed((()=>K.value===J)),e.computed((()=>K.value===Q));let X=null,Y=async e=>{X&&(X.abort(),X=null),X=new AbortController;let{signal:t}=X;try{K.value=G;let l=await c(e,t);t.aborted||(K.value=J,m.value=l)}catch{t.aborted||(K.value=Q)}};e.watch((()=>d.modelValue),(e=>{if(e){b.value!==e&&Y(e)}else q()}),{immediate:!0}),e.watch(b,(e=>{v("update:modelValue",e)})),e.watch((()=>{let e=m.value;if(e){let t=f.value,l=p.value,{imageFormat:a,imageQuality:n}=d,i=h.value,u=y.value,o=w.value,r=I.value,c=F.value,s=P.value,v=C.value,m=E.value,g=document.createElement("canvas"),b=g.getContext("2d");return g.width=i,g.height=u,b.translate(i/2,u/2),b.scale(m,m),b.scale(o?-1:1,r?-1:1),b.rotate(v),b.translate(c,s),b.drawImage(e,-t/2,-l/2),g.toDataURL(`image/${a}`,n)}return null}),(e=>{b.value=e}));let Z=e=>{e.preventDefault();let t=document.createElement("input");t.setAttribute("type","file"),t.addEventListener("change",(e=>{e.preventDefault();let{files:t}=e.target;if(t&&t.length){let[e]=t;Y(e)}})),t.click()},_=e.shallowRef(!0);return()=>{let c=e.resolveComponent("VBtn"),s=(t,l)=>{let{disabled:a}=d;return e.h(c,{disabled:a,icon:t,onClick:l})},{clearable:v,disabled:f,readonly:p}=d,S=m.value,R=g.value,H=h.value,z=y.value;b.value;let V=w.value,B=I.value,N=F.value,W=P.value,T=C.value,j=E.value,O=_.value;return e.h("div",{style:{display:"inline-grid",gridTemplateColumns:"1fr auto",gridTemplateRows:"1fr auto"}},[e.h("div",{style:{...r(8,"#fff","#000"),...o,...i,gridColumn:1,gridRow:1,minHeight:`${z+50}px`,minWidth:`${H+50}px`}},R?[e.h("div",{style:{...n,width:`${H}px`,height:`${z}px`}},[e.h("div",{style:{...n,...t}},[e.h("img",{src:R,style:{display:"block",transform:[`scale(${j})`,`scale(${[V?-1:1,B?-1:1].join(",")})`,`rotate(${T}rad)`,`translate(${N}px,${W}px)`].join(" "),...O?{transition:"all .3s cubic-bezier(.25,.8,.5,1)"}:{}}})]),e.h("div",{style:{...u,boxShadow:"0 0 4000px 4000px rgba(0,0,0,0.5)",outline:"4px solid #fff"}})])]:[e.h(c,{icon:"mdi-upload",onClick:Z})]),e.h("div",{style:{display:"flex",flexDirection:"column",gridColumn:2,gridRow:1,justifyContent:"center",...a,...S?{}:l}},[...p?[]:[...v?[s(d.clearIcon,q)]:[],s(d.flipHorizontallyIcon,x),s(d.flipVerticallyIcon,M),s(d.rotateClockwiseIcon,$),s(d.rotateCounterClockwiseIcon,k)],e.h("div",{onClick(){U(0,-10)}},"UP"),e.h("div",{onClick(){U(0,10)}},"DOWN"),e.h("div",{onClick(){U(-10,0)}},"LEFT"),e.h("div",{onClick(){U(10,0)}},"RIGHT")]),e.h("div",{style:{gridColumn:1,gridRow:2,...a,...S?{}:l}},p?[]:[e.h("div",{style:{display:"flex",justifyContent:"space-between"}},[s(d.zoomOutIcon,L),s(d.zoomInIcon,D)]),e.h("div",{style:{whiteSpace:"pre-wrap"}},JSON.stringify({translationHorizontally:N,translationVertically:W,zoom:j},null,"  "))])])}}})}));
