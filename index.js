!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VuetifyImageInput=t()}(this,(function(){"use strict";var e={pointerEvents:"none",userDrag:"none",userSelect:"none"},t={...e,opacity:0,visibility:"hidden"},l={transition:"all .3s cubic-bezier(.25,.8,.5,1)"},a={bottom:"50%",position:"absolute",right:"50%",transform:"translate(50%,50%)"},n={position:"relative"},i={bottom:0,left:0,position:"absolute",right:0,top:0},o={overflow:"hidden"};function r(e,t,l){return function(e,t,l){return{background:`url('data:image/svg+xml;base64,${btoa(e)}') center center / ${t}px ${t}px repeat ${l}`}}(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2 2" fill="${t}"><rect x="1" width="1" height="1"/><rect y="1" width="1" height="1"/></svg>`,2*e,l)}async function u(e){let t=new Image;return t.src=e,await t.decode(),t}async function d(e,t){if(function(e){return"string"==typeof e}(e))return u(e);if(function(e){let{File:t}=globalThis;return t&&e instanceof t}(e))return async function(e,t){let l=new FileReader,a=new Promise(((e,t)=>{l.addEventListener("load",e),l.addEventListener("abort",t),l.addEventListener("error",t)}));return l.readAsDataURL(e),t.onabort=()=>{l.abort()},await a,t.onabort=null,u(l.result)}(e,t);throw new Error}let{computed:c,defineComponent:s,h:f,shallowRef:m,watch:p,watchEffect:v,triggerRef:g,resolveComponent:y}=Vue;return s({name:"VImageInput",props:{cancelIcon:{type:String,default:"$cancel"},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:"$clear"},disabled:{type:Boolean,default:!1},errorIcon:{type:String,default:"$error"},flipHorizontallyIcon:{type:String,default:"mdi-flip-horizontal"},flipVerticallyIcon:{type:String,default:"mdi-flip-vertical"},fullHeight:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1},hideActions:{type:Boolean,default:!1},imageBackgroundColor:String,imageHeight:{type:Number,default:256},imageMaxHeight:{type:Number,default:512},imageMaxWidth:{type:Number,default:512},imageMinHeight:{type:Number,default:128},imageMinWidth:{type:Number,default:128},imageWidth:{type:Number,default:256},maxZoom:{type:Number,default:1},minZoom:{type:String,default:"cover"},modelValue:String,readonly:{type:Boolean,default:!1},resetable:{type:Boolean,default:!1},resetIcon:{type:String,default:"mdi-restore"},rotateClockwiseIcon:{type:String,default:"mdi-rotate-right"},rotateCounterClockwiseIcon:{type:String,default:"mdi-rotate-left"},successIcon:{type:String,default:"$success"},uploadIcon:{type:String,default:"mdi-upload"},zoomInIcon:{type:String,default:"mdi-magnify-plus-outline"},zoomOutIcon:{type:String,default:"mdi-magnify-minus-outline"}},setup(u,{emit:s}){let v=m(null),g=c((()=>{let e=v.value;return e?e.naturalWidth:0})),h=c((()=>{let e=v.value;return e?e.naturalHeight:0})),b=c((()=>{let e=v.value;return e?e.src:null})),w=m(256),I=m(256),x=m(null),C=m(!1),S=()=>{C.value=!C.value},$=m(!1),k=()=>{$.value=!$.value},B=m(0),z=e=>{C.value!==$.value&&(e*=-1),B.value+=e},E=Math.PI/2,R=()=>{z(+E)},V=()=>{z(-E)},H=c((()=>.1)),M=c((()=>{let e=H.value,t=u.maxZoom;return Math.max(e,t)})),N=m(0),D=c({get(){let e=H.value,t=M.value;return function(e,t,l){return Math.min(Math.max(e,t),l)}(N.value,e,t)},set(e){N.value=e}}),L=e=>{D.value+=e},W=c((()=>{let e=H.value;return(M.value-e)/10})),j=()=>{let e=W.value;L(+e)},T=()=>{let e=W.value;L(-e)};c((()=>{let e=H.value;return(M.value-e)/1e3}));let A=()=>{v.value=null},F={},Z={},O={},P=m(null);c((()=>P.value===F)),c((()=>P.value===Z)),c((()=>P.value===O));let U=null,Q=async e=>{U&&(U.abort(),U=null),U=new AbortController;let{signal:t}=U;try{P.value=F;let l=await d(e,t);t.aborted||(P.value=Z,v.value=l)}catch{t.aborted||(P.value=O)}};p((()=>u.modelValue),(e=>{if(e){x.value!==e&&Q(e)}else A()}),{immediate:!0}),p(x,(e=>{s("update:modelValue",e)})),p((()=>{let e=v.value;if(e){let t=g.value,l=h.value,{imageFormat:a,imageQuality:n}=u,i=w.value,o=I.value,r=C.value,d=$.value,c=B.value,s=D.value,f=document.createElement("canvas"),m=f.getContext("2d");return f.width=i,f.height=o,m.translate(i/2,o/2),m.scale(s,s),m.scale(r?-1:1,d?-1:1),m.rotate(c),m.drawImage(e,-t/2,-l/2),f.toDataURL(`image/${a}`,n)}return null}),(e=>{x.value=e}));let q=e=>{e.preventDefault();let t=document.createElement("input");t.setAttribute("type","file"),t.addEventListener("change",(e=>{e.preventDefault();let{files:t}=e.target;if(t&&t.length){let[e]=t;Q(e)}})),t.click()};return()=>{let d=y("VBtn"),c=(e,t)=>f(d,{icon:e,onClick:t}),{clearable:s,disabled:m,readonly:p}=u,g=v.value,h=b.value,z=w.value,E=I.value;x.value;let H=C.value,M=$.value,N=B.value,L=D.value;return f("div",{style:{display:"inline-grid",gridTemplateColumns:"1fr auto",gridTemplateRows:"1fr auto"}},[f("div",{style:{...r(8,"#fff","#000"),...o,...n,gridColumn:1,gridRow:1,minHeight:`${E+50}px`,minWidth:`${z+50}px`}},h?[f("div",{style:{...e,...a,width:`${z}px`,height:`${E}px`}},[f("div",{style:{...a}},[f("img",{src:h,style:{display:"block",transform:[`scale(${L})`,`scale(${[H?-1:1,M?-1:1].join(",")})`,`rotate(${N}rad)`].join(" "),transition:"all .3s cubic-bezier(.25,.8,.5,1)"}})]),f("div",{style:{...i,boxShadow:"0 0 4000px 4000px rgba(0,0,0,0.5)",outline:"4px solid #fff"}})])]:[f(d,{icon:"mdi-upload",onClick:q})]),f("div",{style:{display:"flex",flexDirection:"column",gridColumn:2,gridRow:1,justifyContent:"center",...l,...g?{}:t}},[...p?[]:[...s?[c(u.clearIcon,A)]:[],c(u.flipHorizontallyIcon,S),c(u.flipVerticallyIcon,k),c(u.rotateClockwiseIcon,R),c(u.rotateCounterClockwiseIcon,V)]]),f("div",{style:{gridColumn:1,gridRow:2,...l,...g?{}:t}},p?[]:[f("div",{style:{display:"flex",justifyContent:"space-between"}},[c(u.zoomOutIcon,T),c(u.zoomInIcon,j)])])])}}})}));
