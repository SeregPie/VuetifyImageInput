!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VuetifyImageInput=t()}(this,(function(){"use strict";async function e(e){let t=new Image;return t.src=e,await t.decode(),t}async function t(t,l){if(function(e){return"string"==typeof e}(t))return e(t);if(function(e){let{File:t}=globalThis;return t&&e instanceof t}(t))return async function(t,l){let a=new FileReader,n=new Promise(((e,t)=>{a.addEventListener("load",e),a.addEventListener("abort",t),a.addEventListener("error",t)}));return a.readAsDataURL(t),l.onabort=()=>{a.abort()},await n,l.onabort=null,e(a.result)}(t,l);throw new Error}let{computed:l,defineComponent:a,h:n,shallowRef:i,watch:r,watchEffect:u,triggerRef:o}=Vue;return a({name:"VImageInput",props:{cancelIcon:{type:String,default:"$cancel"},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:"$clear"},disabled:{type:Boolean,default:!1},errorIcon:{type:String,default:"$error"},flipHorizontallyIcon:{type:String,default:"mdi-flip-horizontal"},flippable:{type:Boolean,default:!1},flipVerticallyIcon:{type:String,default:"mdi-flip-vertical"},fullHeight:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1},imageBackgroundColor:String,imageHeight:{type:Number,default:256},imageMaxHeight:{type:Number,default:512},imageMaxWidth:{type:Number,default:512},imageMinHeight:{type:Number,default:128},imageMinWidth:{type:Number,default:128},imageWidth:{type:Number,default:256},maxZoom:{type:Number,default:1},minZoom:{type:String,default:"cover"},resetable:{type:Boolean,default:!1},resetIcon:{type:String,default:"mdi-restore"},resizable:{type:Boolean,default:!1},rotatable:{type:Boolean,default:!1},rotateClockwiseIcon:{type:String,default:"mdi-rotate-right"},rotateCounterClockwiseIcon:{type:String,default:"mdi-rotate-left"},successIcon:{type:String,default:"$success"},translatable:{type:Boolean,default:!1},uploadIcon:{type:String,default:"mdi-upload"},value:String,zoomable:{type:Boolean,default:!1},zoomInIcon:{type:String,default:"mdi-magnify-plus-outline"},zoomOutIcon:{type:String,default:"mdi-magnify-minus-outline"}},setup(e,{emit:a}){let u=i(null),o=l((()=>{let e=u.value;return e?e.naturalWidth:0})),d=l((()=>{let e=u.value;return e?e.naturalHeight:0})),c=l((()=>{let e=u.value;return e?e.src:null})),f=i(256),m=i(256),s=i(null),v=i(!1),p=()=>{v.value=!v.value},g=i(!1),y=()=>{g.value=!g.value},h=i(0),b=e=>{v.value!==g.value&&(e*=-1),h.value+=e},I=Math.PI/2,w=()=>{b(+I)},S=()=>{b(-I)},k=l((()=>.001)),C=l((()=>{let t=k.value,l=e.maxZoom;return Math.max(t,l)})),x=i(0),B=l({get(){let e=k.value,t=C.value,l=B.value;return Math_clamp(l,e,t)},set(e){x.value=e}}),z=e=>{B.value*=e},E=l((()=>{let e=k.value;return(C.value-e)/10})),N=()=>{let e=E.value;z(-e)},$=()=>{let e=E.value;z(+e)};l((()=>{let e=k.value;return(C.value-e)/1e3}));let H={},M={},R={},L=i(null),V=l((()=>L.value===H)),W=l((()=>L.value===M)),D=l((()=>L.value===R)),A=null,F=async e=>{A&&(A.abort(),A=null),A=new AbortController;let{signal:l}=A;try{L.value=H;let a=await t(e,l);l.aborted||(L.value=M,u.value=a)}catch{l.aborted||(L.value=R)}};r((()=>e.modelValue),(e=>{null==e?u.value=null:F(e)}),{immediate:!0}),r(s,(e=>{a("update:modelValue",e)})),r((()=>{let t=u.value;if(t){let l=o.value,a=d.value,{imageFormat:n,imageQuality:i}=e,r=f.value,u=m.value,{a:c,b:s,c:v,d:p,e:g,f:y}=transformationRef.value,h=document.createElement("canvas"),b=h.getContext("2d");return h.width=r,h.height=u,b.translate(r/2,u/2),b.transform(c,s,v,p,g,y),b.drawImage(t,-l/2,-a/2),h.toDataURL(`image/${n}`,i)}return null}),(e=>{s.value=e}));let T=e=>{e.preventDefault();let t=document.createElement("input");t.setAttribute("type","file"),t.addEventListener("change",(e=>{e.preventDefault();let{files:t}=e.target;if(t&&t.length){let[e]=t;F(e)}})),t.click()};return()=>{let e=o.value,t=d.value,l=c.value,a=V.value,i=W.value,r=D.value,u=s.value,{a:v,b:g,c:h,d:b,e:I,f:k}=transformationRef.value,C=f.value,x=m.value;return n("div",[n("div",{style:{whiteSpace:"pre-wrap"}},JSON.stringify({internalImageWidth:e,internalImageHeight:t,loading:a,loadSuccess:i,loadError:r},null,"\t")),n("div",{onClick:T},"click me"),n("div",{onClick:p},"flip horizontally"),n("div",{onClick:y},"flip vertically"),n("div",{onClick:w},"rotate clockwise"),n("div",{onClick:S},"rotate counter clockwise"),n("div",{onClick:N},"zoom in"),n("div",{onClick:$},"zoom out"),...u?[n("img",{src:u,style:{background:"green"}})]:[],...l?[n("div",{style:{height:`${x}px`,width:`${C}px`,position:"relative"}},[n("div",{style:{bottom:"50%",position:"absolute",right:"50%",transform:"translate(50%,50%)"}},[n("img",{src:l,style:{transform:`matrix(${[v,g,h,b,I,k].join(",")})`,transition:"all .3s cubic-bezier(.25,.8,.5,1)"}})])])]:[]])}}})}));
