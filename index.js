!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VuetifyImageInput=t()}(this,(function(){"use strict";async function e(e){let t=new Image;return t.src=e,await t.decode(),t}async function t(t,l){if(function(e){return"string"==typeof e}(t))return e(t);if(function(e){let{File:t}=globalThis;return t&&e instanceof t}(t))return async function(t,l){let a=new FileReader,n=new Promise(((e,t)=>{a.addEventListener("load",e),a.addEventListener("abort",t),a.addEventListener("error",t)}));return a.readAsDataURL(t),l.onabort=()=>{a.abort()},await n,l.onabort=null,e(a.result)}(t,l);throw new Error}let{computed:l,defineComponent:a,h:n,shallowRef:r,watch:u,watchEffect:i,triggerRef:o}=Vue;return a({name:"VImageInput",props:{imageFormat:{type:String,default:"png"},imageQuality:{}},setup(e,{emit:a}){let i=r(null),o=l((()=>{let e=i.value;return e?e.naturalWidth:0})),d=l((()=>{let e=i.value;return e?e.naturalHeight:0}));l((()=>{let e=i.value;return e?e.src:null}));let c=r(256),f=r(256),v=r(null),s=r(new DOMMatrix),g=()=>{let e=s.value;s.value=e.flipX()},m=()=>{let e=s.value;s.value=e.flipY()},p={},h={},y={},w=r(null),b=l((()=>w.value===p)),E=l((()=>w.value===h)),I=l((()=>w.value===y)),k=null,C=async e=>{k&&(k.abort(),k=null),k=new AbortController;let{signal:l}=k;try{w.value=p;let a=await t(e,l);l.aborted||(w.value=h,i.value=a)}catch{l.aborted||(w.value=y)}};u((()=>e.modelValue),(e=>{null==e?i.value=null:C(e)}),{immediate:!0}),u(v,(e=>{a("update:modelValue",e)})),u((()=>{let t=i.value;if(t){let l=o.value,a=d.value,{imageFormat:n,imageQuality:r}=e,u=c.value,i=f.value,{a:v,b:g,c:m,d:p,e:h,f:y}=s.value,w=document.createElement("canvas"),b=w.getContext("2d");return w.width=u,w.height=i,b.translate(u/2,i/2),b.transform(v,g,m,p,h,y),b.drawImage(t,-l/2,-a/2),w.toDataURL(`image/${n}`,r)}return null}),(e=>{v.value=e}));let L=e=>{e.preventDefault();let t=document.createElement("input");t.setAttribute("type","file"),t.addEventListener("change",(e=>{e.preventDefault();let{files:t}=e.target;if(t&&t.length){let[e]=t;C(e)}})),t.click()};return()=>{let e=o.value,t=d.value,l=b.value,a=E.value,r=I.value,u=v.value;return n("div",[n("div",{style:{whiteSpace:"pre-wrap"}},JSON.stringify({internalImageWidth:e,internalImageHeight:t,loading:l,loadSuccess:a,loadError:r},null,"\t")),n("div",{onClick:L},"click me"),n("div",{onClick:g},"flip horizontally"),n("div",{onClick:m},"flip vertically"),...u?[n("img",{src:u,style:{background:"green"}})]:[]])}}})}));
