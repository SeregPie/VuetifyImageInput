!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VuetifyImageInput=t()}(this,(function(){"use strict";async function e(e){let t=new Image;return t.src=e,await t.decode(),t}async function t(t,l){if(function(e){return"string"==typeof e}(t))return e(t);if(function(e){let{File:t}=globalThis;return t&&e instanceof t}(t))return async function(t,l){let a=new FileReader,n=new Promise(((e,t)=>{a.addEventListener("load",e),a.addEventListener("abort",t),a.addEventListener("error",t)}));return a.readAsDataURL(t),l.onabort=()=>{a.abort()},await n,l.onabort=null,e(a.result)}(t,l);throw new Error}let{computed:l,createApp:a,h:n,reactive:u,shallowRef:r,watchEffect:i,watch:o,defineComponent:d}=Vue;return d({name:"VImageInput",props:{imageFormat:{type:String,default:"png"},imageQuality:{}},setup(e,{emit:a}){let u=r(null),d=l((()=>{let e=u.value;return e?e.naturalWidth:0})),c=l((()=>{let e=u.value;return e?e.naturalHeight:0}));l((()=>{let e=u.value;return e?e.src:null}));let v=r(256),s=r(256),f=r(null),m=r(false),g=()=>{m.value=!m.value},p=r(false),h=()=>{p.value=!p.value},y=e=>{m.value=!1,p.value=!1,u.value=e},w=()=>y(null),b={},E={},I={},k=r(null),C=l((()=>k.value===b)),L=l((()=>k.value===E)),V=l((()=>k.value===I)),A=null,D=async e=>{A&&(A.abort(),A=null),A=new AbortController;let{signal:l}=A;try{k.value=b;let a=await t(e,l);l.aborted||(k.value=E,y(a))}catch{l.aborted||(k.value=I,w())}};o((()=>e.modelValue),(e=>{null==e?w():D(e)}),{immediate:!0}),o(f,(e=>{a("update:modelValue",e)})),i((()=>{let t=u.value;if(t){d.value,c.value;let l=v.value,a=s.value,n=m.value,u=p.value,{imageFormat:r,imageQuality:i}=e,o=document.createElement("canvas"),g=o.getContext("2d");o.width=l,o.height=a;let h=l,y=a,w=0,b=0;g.translate(w+h/2,b+y/2),g.scale(n?-1:1,u?-1:1),g.drawImage(t,-h/2,-y/2);let E=o.toDataURL(`image/${r}`,i);f.value=E}else f.value=null}));let F=e=>{e.preventDefault();let t=document.createElement("input");t.setAttribute("type","file"),t.addEventListener("change",(e=>{e.preventDefault();let{files:t}=e.target;if(t&&t.length){let[e]=t;D(e)}})),t.click()};return()=>{let e=d.value,t=c.value,l=C.value,a=L.value,u=V.value,r=f.value;return n("div",[n("div",{style:{whiteSpace:"pre-wrap"}},JSON.stringify({internalImageWidth:e,internalImageHeight:t,loading:l,loadSuccess:a,loadError:u},null,"\t")),n("div",{onClick:F},"click me"),n("div",{onClick:g},"flip horizontally"),n("div",{onClick:h},"flip vertically"),...r?[n("img",{src:r,style:{background:"green"}})]:[]])}}})}));
