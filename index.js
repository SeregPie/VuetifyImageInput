!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VuetifyImageInput=t()}(this,(function(){"use strict";var e={bottom:"50%",position:"absolute",right:"50%",transform:"translate(50%,50%)"},t={position:"relative"},l={bottom:0,left:0,position:"absolute",right:0,top:0},a={overflow:"hidden"},n={pointerEvents:"none",userDrag:"none",userSelect:"none"};function o(e,t,l){return function(e,t,l){return{background:`url('data:image/svg+xml;base64,${btoa(e)}') center center / ${t}px ${t}px repeat ${l}`}}(`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2 2" fill="${t}"><rect x="1" width="1" height="1"/><rect y="1" width="1" height="1"/></svg>`,2*e,l)}async function r(e){let t=new Image;return t.src=e,await t.decode(),t}async function i(e,t){if(function(e){return"string"==typeof e}(e))return r(e);if(function(e){let{File:t}=globalThis;return t&&e instanceof t}(e))return async function(e,t){let l=new FileReader,a=new Promise(((e,t)=>{l.addEventListener("load",e),l.addEventListener("abort",t),l.addEventListener("error",t)}));return l.readAsDataURL(e),t.onabort=()=>{l.abort()},await a,t.onabort=null,r(l.result)}(e,t);throw new Error}let{computed:u,defineComponent:d,h:f,shallowRef:c,watch:s,watchEffect:p,triggerRef:m,resolveComponent:g}=Vue;return d({name:"VImageInput",props:{cancelIcon:{type:String,default:"$cancel"},clearable:{type:Boolean,default:!1},clearIcon:{type:String,default:"$clear"},disabled:{type:Boolean,default:!1},errorIcon:{type:String,default:"$error"},flipHorizontallyIcon:{type:String,default:"mdi-flip-horizontal"},flippable:{type:Boolean,default:!1},flipVerticallyIcon:{type:String,default:"mdi-flip-vertical"},fullHeight:{type:Boolean,default:!1},fullWidth:{type:Boolean,default:!1},imageBackgroundColor:String,imageHeight:{type:Number,default:256},imageMaxHeight:{type:Number,default:512},imageMaxWidth:{type:Number,default:512},imageMinHeight:{type:Number,default:128},imageMinWidth:{type:Number,default:128},imageWidth:{type:Number,default:256},maxZoom:{type:Number,default:1},minZoom:{type:String,default:"cover"},modelValue:String,resetable:{type:Boolean,default:!1},resetIcon:{type:String,default:"mdi-restore"},resizable:{type:Boolean,default:!1},rotatable:{type:Boolean,default:!1},rotateClockwiseIcon:{type:String,default:"mdi-rotate-right"},rotateCounterClockwiseIcon:{type:String,default:"mdi-rotate-left"},successIcon:{type:String,default:"$success"},translatable:{type:Boolean,default:!1},uploadIcon:{type:String,default:"mdi-upload"},zoomable:{type:Boolean,default:!1},zoomInIcon:{type:String,default:"mdi-magnify-plus-outline"},zoomOutIcon:{type:String,default:"mdi-magnify-minus-outline"}},setup(r,{emit:d}){let p=c(null),m=u((()=>{let e=p.value;return e?e.naturalWidth:0})),v=u((()=>{let e=p.value;return e?e.naturalHeight:0})),y=u((()=>{let e=p.value;return e?e.src:null})),h=c(256),b=c(256),w=c(null),I=c(!1),x=()=>{I.value=!I.value},C=c(!1),S=()=>{C.value=!C.value},$=c(0),B=e=>{I.value!==C.value&&(e*=-1),$.value+=e},z=Math.PI/2,k=()=>{B(+z)},E=()=>{B(-z)},R=u((()=>.1)),M=u((()=>{let e=R.value,t=r.maxZoom;return Math.max(e,t)})),V=c(0),H=u({get(){let e=R.value,t=M.value;return function(e,t,l){return Math.min(Math.max(e,t),l)}(V.value,e,t)},set(e){V.value=e}}),N=e=>{H.value+=e},D=u((()=>{let e=R.value;return(M.value-e)/10})),L=()=>{let e=D.value;N(+e)},j=()=>{let e=D.value;N(-e)};u((()=>{let e=R.value;return(M.value-e)/1e3}));let T={},W={},A={},F=c(null);u((()=>F.value===T)),u((()=>F.value===W)),u((()=>F.value===A));let Z=null,O=async e=>{Z&&(Z.abort(),Z=null),Z=new AbortController;let{signal:t}=Z;try{F.value=T;let l=await i(e,t);t.aborted||(F.value=W,p.value=l)}catch{t.aborted||(F.value=A)}};s(w,(e=>{d("update:modelValue",e)})),s((()=>{let e=p.value;if(e){let t=m.value,l=v.value,{imageFormat:a,imageQuality:n}=r,o=h.value,i=b.value,u=I.value,d=C.value,f=$.value,c=H.value,s=document.createElement("canvas"),p=s.getContext("2d");return s.width=o,s.height=i,p.translate(o/2,i/2),p.scale(c,c),p.scale(u?-1:1,d?-1:1),p.rotate(f),p.drawImage(e,-t/2,-l/2),s.toDataURL(`image/${a}`,n)}return null}),(e=>{w.value=e}));let P=e=>{e.preventDefault();let t=document.createElement("input");t.setAttribute("type","file"),t.addEventListener("change",(e=>{e.preventDefault();let{files:t}=e.target;if(t&&t.length){let[e]=t;O(e)}})),t.click()};return()=>{let i=g("VBtn"),u=(e,t)=>f(i,{icon:e,onClick:t}),d=y.value,c=h.value,s=b.value;w.value;let p=I.value,m=C.value,v=$.value,B=H.value;return f("div",{style:{display:"inline-grid",gridTemplateColumns:"1fr auto",gridTemplateRows:"1fr auto"}},[f("div",{style:{...o(8,"#fff","#000"),...a,...t,gridColumn:1,gridRow:1,width:`${c+50}px`,height:`${s+50}px`}},d?[f("div",{style:{...n,...e,width:`${c}px`,height:`${s}px`}},[f("div",{style:{...e}},[f("img",{src:d,style:{transform:[`scale(${B})`,`scale(${[p?-1:1,m?-1:1].join(",")})`,`rotate(${v}rad)`].join(" "),transition:"all .3s cubic-bezier(.25,.8,.5,1)"}})]),f("div",{style:{...l,boxShadow:"0 0 4000px 4000px rgba(0,0,0,0.5)",outline:"4px solid #fff"}})])]:[]),f("div",{style:{display:"flex",flexDirection:"column",gridColumn:2,gridRow:1,justifyContent:"center"}},[f(i,{icon:"mdi-load",onClick:P}),u(r.flipHorizontallyIcon,x),u(r.flipVerticallyIcon,S),u(r.rotateClockwiseIcon,k),u(r.rotateCounterClockwiseIcon,E)]),f("div",{style:{gridColumn:1,gridRow:2}},[f("div",{style:{display:"flex",justifyContent:"space-between"}},[u(r.zoomOutIcon,j),u(r.zoomInIcon,L)])])])}}})}));
